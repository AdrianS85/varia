## Emacs, make this -*- mode: sh; -*-
BootStrap: docker
From: ubuntu:18.04
MirrorURL: http://us.archive.ubuntu.com/ubuntu/

#BUILD: sudo singularity build --writable R_Singularity.simg ./SingularityRubuntu
#SANDBOX: sudo singularity build -s sandbox1.simg ./SingularityRubuntu
#ENTER: sudo singularity shell --cleanenv --bind ./Bind:/ --workdir /Analysis --writable R_Singularity.simg

%environment
## Configure default locale, see https://github.com/rocker-org/rocker/issues/19
	export LANGUAGE=en_US.UTF-8
        export LANG=en_US.UTF-8
        export LC_ALL=en_US.UTF-8
	
%post
	apt update
	apt -y install vim wget curl language-pack-en fonts-texgyre
	mkdir Analysis

## Now install R and littler, and create a link for littler in /usr/local/bin
## Also set a default CRAN repo, and make sure littler knows about it too
	apt -y install littler r-cran-littler r-cran-stringr r-base r-base-dev r-recommended gdebi libssl-dev libxml2-dev libmariadbclient-dev
        echo 'options(repos = c(CRAN = "https://cloud.r-project.org/"))' >> /etc/R/Rprofile.site
        echo 'source("/etc/R/Rprofile.site")' >> /etc/littler.r
	ln -s /usr/lib/R/site-library/littler/examples/install.r /usr/local/bin/install.r
	ln -s /usr/lib/R/site-library/littler/examples/install2.r /usr/local/bin/install2.r
	ln -s /usr/lib/R/site-library/littler/examples/installGithub.r /usr/local/bin/installGithub.r
	ln -s /usr/lib/R/site-library/littler/examples/testInstalled.r /usr/local/bin/testInstalled.r
	install.r docopt
	rm -rf /tmp/downloaded_packages/ /tmp/*.rds
	rm -rf /var/lib/apt/lists/*

R -e 'source("https://bioconductor.org/biocLite.R");biocLite("RnBeads");biocLite("RnBeads.mm10");biocLite("doParallel");biocLite("BSgenome.Mmusculus.UCSC.mm10");biocLite("GenomicFeatures");biocLite("bumphunter");biocLite("illuminaio");biocLite("genefilter");biocLite("ggbio")'



R -e 'install.packages(c("openssl", "httr", "xml2"))'

R -e 'source("https://bioconductor.org/biocLite.R");'

bumphunter

R -e 'installed.packages()'

biocLite("ggbio");biocLite("rtracklayer");biocLite("impute")
biocLite("sva")
biocLite("GOstats")
biocLite("org.Mm.eg.db")



ERROR: dependency ‘GenomicFeatures’ is not available for package ‘TxDb.Hsapiens.UCSC.hg19.knownGene’
* removing ‘/usr/local/lib/R/site-library/TxDb.Hsapiens.UCSC.hg19.knownGene’
ERROR: dependency ‘GenomicFeatures’ is not available for package ‘bumphunter’
* removing ‘/usr/local/lib/R/site-library/bumphunter’
ERROR: dependencies ‘httr’, ‘xml2’ are not available for package ‘GEOquery’
* removing ‘/usr/local/lib/R/site-library/GEOquery’
ERROR: dependencies ‘GenomicFeatures’, ‘TxDb.Hsapiens.UCSC.hg19.knownGene’ are not available for package ‘FDb.InfiniumMethylation.hg19’
* removing ‘/usr/local/lib/R/site-library/FDb.InfiniumMethylation.hg19’
ERROR: dependencies ‘bumphunter’, ‘illuminaio’, ‘genefilter’, ‘GEOquery’ are not available for package ‘minfi’
* removing ‘/usr/local/lib/R/site-library/minfi’
ERROR: dependencies ‘FDb.InfiniumMethylation.hg19’, ‘minfi’, ‘annotate’, ‘genefilter’, ‘illuminaio’ are not available for package ‘methylumi’
* removing ‘/usr/local/lib/R/site-library/methylumi’
ERROR: dependencies ‘illuminaio’, ‘methylumi’ are not available for package ‘RnBeads’
* removing ‘/usr/local/lib/R/site-library/RnBeads’


## Emacs, make this -*- mode: sh; -*-
BootStrap: docker
From: ubuntu:18.04
MirrorURL: http://us.archive.ubuntu.com/ubuntu/

#BUILD: sudo singularity build --writable R_Singularity.simg ./SingularityRubuntu
#SANDBOX: sudo singularity build -s sandbox1.simg ./SingularityRubuntu
#ENTER: sudo singularity shell --cleanenv --bind ./Bind:/ --workdir /Analysis --writable R_Singularity.simg

%environment
## Configure default locale, see https://github.com/rocker-org/rocker/issues/19
	export LANGUAGE=en_US.UTF-8
        export LANG=en_US.UTF-8
        export LC_ALL=en_US.UTF-8
	
%post
	apt update
	apt -y install vim wget curl language-pack-en fonts-texgyre
	mkdir Analysis

## Now install R and littler, and create a link for littler in /usr/local/bin
## Also set a default CRAN repo, and make sure littler knows about it too
	apt -y install littler r-cran-littler r-cran-stringr r-base r-base-dev r-recommended gdebi
        echo 'options(repos = c(CRAN = "https://cloud.r-project.org/"))' >> /etc/R/Rprofile.site
        echo 'source("/etc/R/Rprofile.site")' >> /etc/littler.r
	ln -s /usr/lib/R/site-library/littler/examples/install.r /usr/local/bin/install.r
	ln -s /usr/lib/R/site-library/littler/examples/install2.r /usr/local/bin/install2.r
	ln -s /usr/lib/R/site-library/littler/examples/installGithub.r /usr/local/bin/installGithub.r
	ln -s /usr/lib/R/site-library/littler/examples/testInstalled.r /usr/local/bin/testInstalled.r
	install.r docopt
	rm -rf /tmp/downloaded_packages/ /tmp/*.rds
	rm -rf /var/lib/apt/lists/*
